<!DOCTYPE html>
<html lang="es" ng-app="appMenu">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <meta http-equiv="x-ua-compatible" content="ie=edge" />
        <title>Alin Burgers</title>
        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://use.fontawesome.com/releases/v5.11.2/css/all.css"
        />
        <!-- Google Fonts Roboto -->
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
        />
        <!-- MDB -->
        <link rel="stylesheet" href="css/mdb.min.css" />
        <!-- Custom styles -->
        <link rel="stylesheet" href="css/style.css" />
    </head>
    <body data-ng-controller="menuCtrl">
        <!--Main Navigation-->
        <header>
            <style>
                #intro {
                    background-image: url("img/banner.jpeg");
                    height: 100vh;
                }

                /* Height for devices larger than 576px */
                @media (min-width: 992px) {
                    #intro {
                        margin-top: -58.59px;
                    }
                }

                .navbar .nav-link {
                    color: #fff !important;
                }
            </style>

            <!-- Navbar -->
            <nav
                class="navbar navbar-expand-lg navbar-dark bg-dark d-none d-lg-block"
                style="z-index: 2000"
            >
                <div class="container-fluid">
                    <!-- Navbar brand -->
                    <a
                        class="navbar-brand nav-link"
                        target="_blank"
                        href="index.html"
                    >
                        <strong>Alin Burgers</strong>
                    </a>
                    <button
                        class="navbar-toggler"
                        type="button"
                        data-mdb-toggle="collapse"
                        data-mdb-target="#navbarExample01"
                        aria-controls="navbarExample01"
                        aria-expanded="false"
                        aria-label="Toggle navigation"
                    >
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarExample01">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item active">
                                <a
                                    class="nav-link"
                                    aria-current="page"
                                    href="index.html"
                                    >Inicio</a
                                >
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="misionVision.html">Nosotros</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="menu.html">Menú</a>
                            </li>
                        </ul>

                        <ul class="navbar-nav d-flex flex-row">
                            <!-- Icons -->
                            <li class="nav-item me-3 me-lg-0">
                                <a
                                    class="nav-link"
                                    href="https://www.facebook.com/profile.php?id=100063828090806"
                                    rel="nofollow"
                                    title="Facebook"
                                >
                                    <i class="fab fa-facebook-f"></i>
                                </a>
                            </li>
                            <!-- <li class="nav-item me-3 me-lg-0">
                                <a
                                    class="nav-link"
                                    href="#"
                                    rel="nofollow"
                                    target="_blank"
                                    title="Twitter"
                                >
                                    <i class="fab fa-twitter"></i>
                                </a>
                            </li> -->
                            <li class="nav-item me-3 me-lg-0">
                                <a
                                    class="nav-link"
                                    href="login.html"
                                    rel="nofollow"
                                    title="Administración"
                                > 
                                    <i class="fa fa-user"></i>
                                </a>
                            </li>
                            <li class="nav-item me-3 me-lg-0">
                                <a
                                    class="nav-link"
                                    href="carrito.html"
                                    title="Carrito"
                                >
                                    <i class="fas fa-cart-arrow-down"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- Navbar -->
        </header>
        <!--Main Navigation-->

        <main class="container mt-5">
            <div class="row flex-wrap">
                <div class="col-6 col-md-4 col-sm-12 mb-4" data-ng-repeat="producto in productos">
                    <div class="card">
                        <div class="bg-image hover-overlay ripple" data-mdb-ripple-color="light">
                          <img src="../fotos/{{producto.imagen}}" alt="no_encontrado" class="img-fluid" />
                          <a href="#!">
                            <div class="mask" style="background-color: rgba(251, 251, 251, 0.15);"></div>
                          </a>
                        </div>
                        <div class="card-body">
                          <h5 class="card-title text-center">{{producto.nombre}}</h5>
                          <p class="card-text text-center">
                        <span>{{producto.precio}}</span>
                          </p>
                          <div
                          class="d-flex justify-content-center align-items-center pb-3"
                      >
                          <button
                              type="button"
                              class="btn btn-outline-success btn-rounded ml-5"
                              data-mdb-ripple-color="dark"
                              data-mdb-toggle="modal" 
                              data-mdb-target="#modalAgregarProducto"
                              data-ng-click="seleccionarProducto(producto)"
                          >
                              Agregar
                          </button>
                          <!-- <a
                              href="#"
                              class="btn btn-outline-info btn-rounded"
                              data-mdb-ripple-color="dark"
                              title="Ver información"
                          >
                              Ver
                          </a> -->
                      </div>
                        </div>
                      </div>
                </div>

            </div>
        </main>

        <!-- Modal -->
<div class="modal fade" id="modalAgregarProducto" tabindex="1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header mt-4">
          <h5 class="modal-title" id="exampleModalLabel">Agregar {{producto.nombre}}</h5>
          <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="card">
                <div class="bg-image hover-overlay ripple" data-mdb-ripple-color="light">
                  <img src="../fotos/{{producto.imagen}}" alt="no_encontrado" class="img-fluid" />
                  <a href="#!">
                    <div class="mask" style="background-color: rgba(251, 251, 251, 0.15);"></div>
                  </a>
                </div>
                <div class="card-body">
                  <h5 class="card-title text-center">{{producto.nombre}}</h5>
                  <p class="card-text text-center">
                    <span>{{producto.precio}}</span> <br><br>
                    <span>Total: {{producto.precio * pedido.cantidad}}</span>
                  </p>
                  
                  <div
                  class="d-flex justify-content-center align-items-center pb-3"
              >
              </div>
                </div>
              </div>
              <form  
                    class="row justify-content-center"
                    name="formMenu"
                    novalidate>
                    <div class="col-md-6 col-sm-12">

                        <div class="form-outline mb-4 active">
                            <input
                                type="number"
                                id="cantidad"
                                class="form-control form-control-lg active"
                                required
                                name="cantidad"
                                data-ng-model="pedido.cantidad"
                            />
                            <label class="form-label" for="cantidad">Cantidad</label>
                        </div>
                    </div>
                </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary" data-mdb-dismiss="modal" ng-click="agregarProducto()">Agregar</button>
        </div>
      </div>
    </div>
  </div>
        <!--Footer-->
        <footer class="bg-light text-lg-start">
            <hr class="m-0" />

            <!-- Copyright -->
            <div
                class="text-center p-3"
                style="background-color: rgba(0, 0, 0, 0.2)"
            >
                © 2022 - 2023 Copyright:
                <a class="text-dark" href="#">Alin Burgers</a>
            </div>
            <!-- Copyright -->
        </footer>
        <!--Footer-->
        <!-- JQuery -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.js"></script>
        <!-- MDB -->
        <script type="text/javascript" src="js/mdb.min.js"></script>
        <!-- Custom scripts -->
        <script type="text/javascript" src="js/script.js"></script>
        <script src="js/angular.min.js"></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            const app = angular.module("appMenu", []);
            app.controller('menuCtrl', function($scope, $http) {
                $scope.productos = [];
                $scope.producto = null;
                $scope.pedido = {};

                $scope.getProductos = () => {
                    $http({
                        url: "/webaalinburgers/app/controller/ProductoController.php?action=getStock",
                        method: "GET"
                    }).then(function(response) {
                        console.log(response.data.data)
                        $scope.productos = response.data.data;
                    }, function(response) {
                        console.log(response);
                        
                    });
                };

               

                $scope.seleccionarProducto = producto => {
                    $scope.producto = producto;
                    $scope.pedido.cantidad = 1;
                };

                $scope.agregarProducto = () => {
                    $scope.pedido.id_producto = $scope.producto.id;
                    $scope.pedido.nombreProducto = $scope.producto.nombre;
                    $scope.pedido.imagen = $scope.producto.imagen;
                    $scope.pedido.precio = $scope.producto.precio;
                    if($scope.pedido.cantidad > $scope.producto.cantidad) {
                        Swal.fire(
                        {
                         icon: 'warning',
                         title: 'Solo quedan '+$scope.producto.cantidad+' disponibles',
                         showConfirmButton: false,
                         timer: 1800
                        }
                       )
                    } else {
                        $scope.agregarProductoPedido();
                    }
                };

                $scope.agregarProductoPedido = () => {
                    $http({
                        url : '/webaalinburgers/app/controller/PedidoController.php?action=addProducto',
                        method : "POST",
                        data :  $.param( $scope.pedido),
                        headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                    }).then(function(response) {
                        Swal.fire(
                        {
                         icon: 'success',
                         title: 'Producto agregado',
                         showConfirmButton: false,
                         timer: 1300
                        }
                       )
                    }, function(response) {
                        console.error(response);

                    });
                }

                angular.element(document).ready(function() {
                    $scope.getProductos();
                 });
            });
        </script>
    </body>
</html>
